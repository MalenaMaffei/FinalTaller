#include "Header Files/PaqueteReceiver.h"
#include "Header Files/common_SocketException.h"
#include <string>
#include <chrono>
PaqueteReceiver::PaqueteReceiver(const Socket &socket, ColaPaquetes &cola)
    : PaqueteDelivery(socket, cola) {}

void PaqueteReceiver::run() {
    while (!salir){
        string mensaje;
        try {
            mensaje = socket.ReceiveStrWLen();
        } catch(SocketException& e ){
//            TODO se podria decir, si ya estaba salir==true, es que cerre yo
// al socket entonces no muestro nada. si salir==false, se cerro desde el server
            displayError(e);
            shutdown();
            continue;
        }

		printf("paquete recibido: %s\n", mensaje.c_str());
        Paquete paquete;
        paquete.setMensaje(mensaje);
        cola.encolar(paquete);






//
//        Paquete color;
//        color.setMensaje("60");
//        cola.encolar(color);
//        Paquete mapa;
//        mapa.setMensaje
//            ("50000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333000000000011111111112222222222333333333300000000001111111111222222222233333333330123012301333333333300000000001111111111222222222233333333330000000000111111111122222222223333333333012301230133333333330000000000111111111122222222223333333333000000000011111111112222222222333333333301230123013333333333");
//        cola.encolar(mapa);
//
//        int espera = 200;
//
//
////        fabrica.setMensaje("1001");
////        cola.encolar(fabrica);
////        fabrica.setMensaje("1002");
////        cola.encolar(fabrica);
//
//        Paquete robot;
//        robot.setMensaje("00030080000200090");
//        cola.encolar(robot);
//        std::this_thread::sleep_for(std::chrono::milliseconds(espera));
//        std::this_thread::sleep_for(std::chrono::milliseconds(espera));
//        std::this_thread::sleep_for(std::chrono::milliseconds(espera*8));
//        printf("listo para recibir info\n");
//        robot.setMensaje("400314090");
//        cola.encolar(robot);
//
//
//        Paquete fabrica;
//        fabrica.setMensaje("0i010500002500031");
//        cola.encolar(fabrica);
////        fabrica.setMensaje("00020050000500041");
////        cola.encolar(fabrica);
//        std::this_thread::sleep_for(std::chrono::milliseconds(espera));
//        std::this_thread::sleep_for(std::chrono::milliseconds(espera));
//        std::this_thread::sleep_for(std::chrono::milliseconds(espera*8));
//        fabrica.setMensaje("70070505002090100100120109050");
//        cola.encolar(fabrica);
//        std::this_thread::sleep_for(std::chrono::milliseconds(espera));
//        std::this_thread::sleep_for(std::chrono::milliseconds(espera));
//        std::this_thread::sleep_for(std::chrono::milliseconds(espera*8));
////        fabrica.setMensaje("700705050020901001001200");
////        cola.encolar(fabrica);
//
//        salir = true;
    }
}
